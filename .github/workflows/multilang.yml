name: Commits Multilinguagem

on:
  schedule:
    - cron: "0 */2 * * *"  # Roda a cada 2 horas para ter janelas de oportunidade
  workflow_dispatch:

jobs:
  commit:
    runs-on: ubuntu-latest
    steps:
      - name: Decidir se faz commit nesta execuÃ§Ã£o
        id: decide
        run: |
          # Gera nÃºmero aleatÃ³rio 0-99
          RAND=$((RANDOM % 100))
          # ~25% de chance por execuÃ§Ã£o (12 execuÃ§Ãµes/dia Ã— 25% â‰ˆ 3-5 commits em mÃ©dia)
          # Ajuste esse valor para mais ou menos commits
          if [ $RAND -lt 25 ]; then
            echo "run=true" >> $GITHUB_OUTPUT
          else
            echo "run=false" >> $GITHUB_OUTPUT
          fi

      - name: Checkout
        if: steps.decide.outputs.run == 'true'
        uses: actions/checkout@v3

      - name: Atualizar arquivos
        if: steps.decide.outputs.run == 'true'
        run: |
          # Escolhe aleatoriamente quais arquivos alterar (nem sempre todos)
          FILES=("simulated-commits/python_script.py"
                 "simulated-commits/javascript_file.js"
                 "simulated-commits/html_page.html"
                 "simulated-commits/style.css"
                 "simulated-commits/app.jsx"
                 "simulated-commits/api.fastapi.py")

          COMMENTS=("# " "// " "<!-- " "/* " "// " "# ")
          SUFFIXES=("" "" " -->" " */" "" "")

          # Escolhe de 2 a 6 arquivos aleatÃ³rios para alterar
          NUM_FILES=$(( (RANDOM % 5) + 2 ))
          
          # Embaralha e pega os primeiros N
          INDICES=($(shuf -i 0-5 -n $NUM_FILES))

          for i in "${INDICES[@]}"; do
            echo "${COMMENTS[$i]}Update $(date +%s)${SUFFIXES[$i]}" >> "${FILES[$i]}"
          done

          # Mensagens de commit variadas para parecer mais natural
          MESSAGES=(
            "ğŸ”§ refactor: clean up code"
            "âœ¨ feat: minor improvements"
            "ğŸ“ docs: update comments"
            "ğŸ¨ style: formatting adjustments"
            "âš¡ perf: optimize logic"
            "ğŸ› fix: resolve edge case"
            "â™»ï¸ chore: routine maintenance"
            "ğŸ§¹ cleanup: remove unused code"
            "ğŸ“¦ update: dependency changes"
            "ğŸ”¨ build: config tweaks"
          )
          MSG=${MESSAGES[$((RANDOM % ${#MESSAGES[@]}))]}

          git config user.name "Leonardo Souza"
          git config user.email "leonardosouzasilva9@gmail.com"
          git add simulated-commits/*
          git commit -m "$MSG" || echo "Nada para commitar"
          git push || echo "Nada para push"
